<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>EXACT Portal</title>

    <!-- Brand font: Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="icon" href="data:," />

    <style>

      /* ===== Customer List (Premium Rows) ===== */

.customer-list {
  display: grid;
  gap: 10px;
  padding: 16px;
}

.customer-row{
  display: grid;
  grid-template-columns: 1.6fr 1.1fr auto;
  gap: 14px;
  align-items: center;
  padding: 14px 14px;
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 14px;
  background: rgba(255,255,255,.03);
}

.customer-row:hover{
  background: rgba(255,255,255,.045);
  border-color: rgba(255,255,255,.12);
}

.customer-main .name{
  font-size: 15px;
  font-weight: 700;
  letter-spacing: .2px;
  line-height: 1.25;
  color: rgba(255,255,255,.92);
}

.customer-main .meta{
  margin-top: 4px;
  font-size: 13px;
  color: rgba(255,255,255,.62);
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  line-height: 1.25;
}

.customer-dot{ opacity: .35; }

.customer-context{
  display: flex;
  gap: 8px;
  justify-content: flex-start;
  flex-wrap: wrap;
}

.pill-soft{
  display: inline-flex;
  align-items: center;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.04);
  font-size: 12px;
  color: rgba(255,255,255,.62);
  white-space: nowrap;
}

.pill-soft-gold{
  border-color: rgba(201,162,74,.35);
  background: rgba(201,162,74,.10);
  color: rgba(255,255,255,.82);
}


.customer-actions{
  display: inline-flex;
  gap: 10px;
  justify-content: flex-end;
}

.btn{
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  color: rgba(255,255,255,.92);
  padding: 10px 12px;
  font-size: 13px;
  font-weight: 650;
  cursor: pointer;
}

.btn:hover{ background: rgba(255,255,255,.06); }
.btn:active{ transform: translateY(1px); }

.btn-primary{
  border-color: rgba(201,162,74,.35);
  background: rgba(201,162,74,.12);
}

.btn-danger{
  border-color: rgba(255,77,77,.35);
  background: rgba(255,77,77,.10);
}

@media (max-width: 768px){
  .customer-list { padding: 12px; }
  .customer-row{
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .customer-actions{ justify-content: flex-start; }
}

      :root{
        --bg: #fbfbfc;
        --card: #ffffff;
        --text: #0b0b0c;
        --muted: #6b6f76;
        --line: rgba(15, 20, 25, .10);
        --shadow: 0 12px 30px rgba(15,20,25,.08);
        --radius: 14px;

        --gold: #b89a5b;
        --gold-dark: #9e8247;
        --danger: #b42318;
      }

      *, *::before, *::after { box-sizing: border-box; }

      body{
        margin:0;
        font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
      }

      .container{
        max-width: 1100px;
        margin: 36px auto;
        padding: 0 18px 60px;
      }

      h1{
        font-size: 34px;
        font-weight: 700;
        letter-spacing: .6px;
        margin: 0 0 18px;
      }

      h2{
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 1.4px;
        text-transform: uppercase;
        margin: 0 0 12px;
        color: var(--muted);
      }

      .topbar{
        background: #fafafa;
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: none;
        padding: 14px 16px;
        margin-bottom: 18px;
      }

      .row{
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap: 12px;
      }

      .subtle{
        color: var(--muted);
        font-size: 12px;
        margin-top: 2px;
      }

      .card{
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 16px;
        margin: 14px 0;
      }

      /* App layout: sidebar + content */
      .appLayout{
        display: grid;
        grid-template-columns: 260px 1fr;
        gap: 14px;
        align-items: start;
      }

      @media (max-width: 840px){
        .appLayout{
          grid-template-columns: 1fr;
        }
      }

      /* Menu */
      .menu{
        position: sticky;
        top: 14px;
      }

      .menuBtn{
        width: 100%;
        text-align: left;
        padding: 11px 12px;
        border-radius: 12px;
        border: 1px solid var(--line);
        background: #fff;
        font-weight: 600;
        cursor: pointer;
        margin-bottom: 8px;
        transition: box-shadow .15s ease, border-color .15s ease, transform .05s ease;
      }
      .menuBtn:hover{
        border-color: rgba(184,154,91,.45);
        box-shadow: 0 10px 22px rgba(15,20,25,.08);
      }
      .menuBtn:active{ transform: translateY(1px); }

      .menuBtn.active{
        border-color: rgba(184,154,91,.75);
        box-shadow: 0 16px 30px rgba(15,20,25,.10);
      }

      /* Controls */
      input, select{
        width: 100%;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--line);
        outline: none;
        background: #fff;
        font-size: 14px;
      }
      input:focus, select:focus{
        border-color: rgba(184,154,91,.55);
        box-shadow: 0 0 0 4px rgba(184,154,91,.18);
      }

      button{
        appearance:none;
        border: 1px solid var(--line);
        background: #fff;
        padding: 9px 12px;
        border-radius: 12px;
        font-weight: 600;
        cursor:pointer;
        transition: transform .05s ease, box-shadow .15s ease, border-color .15s ease;
      }
      button:hover{
        border-color: rgba(184,154,91,.45);
        box-shadow: 0 10px 22px rgba(15,20,25,.08);
      }
      button:active{ transform: translateY(1px); }

      .btn-primary{
        background: var(--text);
        color: #fff;
        border-color: transparent;
      }

      .btn-gold{
        background: var(--gold);
        color: #fff;
        border-color: transparent;
      }
      .btn-gold:hover{ background: var(--gold-dark); }

      .btn-danger{
        background: #fff;
        border-color: rgba(180,35,24,.35);
        color: var(--danger);
      }

      #logoutBtn{
        font-size: 13px;
        font-weight: 500;
        padding: 6px 10px;
        opacity: 0.75;
      }
      #logoutBtn:hover{ opacity: 1; }

      /* Lists */
      ul{
        list-style: none;
        padding: 0;
        margin: 10px 0 0;
      }
      li{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap: 12px;
        padding: 12px 10px;
        border-top: 1px solid var(--line);
      }
      li:first-child{ border-top: 0; }

      #authMsg, #custMsg, #agentMsg, #labMsg{
        margin: 10px 0 0;
        font-size: 12px;
        color: var(--muted);
      }

      /* Customer row premium classes (used by app.js) */
      .cust-row{
        display:flex;
        align-items:flex-start;
        justify-content:space-between;
        gap: 12px;
        width: 100%;
      }
      .cust-left{
        display:flex;
        flex-direction:column;
        gap: 4px;
      }
      .cust-name{ font-weight: 600; }
      .cust-details{
        font-size: 12px;
        color: var(--muted);
        line-height: 1.4;
      }
      .pill{
        display:inline-flex;
        align-items:center;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: .4px;
        border: 1px solid rgba(184,154,91,.45);
        color: var(--gold-dark);
        background: rgba(184,154,91,.10);
        margin-top: 6px;
        width: fit-content;
      }
      .actions{
        display:flex;
        gap: 8px;
      }
      .btn-small{
        padding: 7px 10px;
        border-radius: 10px;
        font-size: 12px;
      }

      /* Dialog */
      dialog{
        border: 1px solid var(--line);
        border-radius: 16px;
        box-shadow: 0 28px 70px rgba(15,20,25,.22);
        padding: 16px;
        width: min(520px, calc(100vw - 26px));
      }
      dialog::backdrop{
        background: rgba(10,10,12,.55);
      }
      .dialog-title{
        font-family: Montserrat, sans-serif;
        font-weight: 600;
        letter-spacing: .4px;
        margin: 0 0 6px 0;
      }
      .dialog-actions{
        display:flex;
        justify-content:flex-end;
        gap:8px;
        margin-top: 12px;
      }
      /* ===== Customer List (Premium Rows) — LIGHT THEME OVERRIDE ===== */
.customer-list{
  display: grid;
  gap: 12px;
  padding: 10px 0;   /* match your card padding */
}

.customer-row{
  display: grid;
  grid-template-columns: 1.6fr 1.1fr auto;
  gap: 14px;
  align-items: center;
  padding: 14px 14px;
  border: 1px solid var(--line);
  border-radius: 14px;
  background: #fff;
  box-shadow: 0 10px 22px rgba(15,20,25,.06);
}

.customer-row:hover{
  border-color: rgba(184,154,91,.45);
  box-shadow: 0 14px 28px rgba(15,20,25,.08);
}

.customer-main .name{
  font-size: 15px;
  font-weight: 700;
  letter-spacing: .2px;
  line-height: 1.25;
  color: var(--text);
}

.customer-main .meta{
  margin-top: 4px;
  font-size: 13px;
  color: var(--muted);
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  line-height: 1.25;
}

.customer-dot{
  opacity: .35;
  color: var(--muted);
}

/* Pills for the new rows (kept separate from your existing .pill) */
.pill-soft{
  display: inline-flex;
  align-items: center;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(184,154,91,.35);
  background: rgba(184,154,91,.08);
  font-size: 12px;
  color: var(--gold-dark);
  white-space: nowrap;
}

.pill-soft-gold{
  border-color: rgba(184,154,91,.55);
  background: rgba(184,154,91,.14);
  color: var(--gold-dark);
}

.customer-actions{
  display: inline-flex;
  gap: 10px;
  justify-content: flex-end;
}

/* Buttons inside rows — use your existing button styles, just size nicely */
.customer-actions .btn{
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 13px;
}

/* Mobile: stack */
@media (max-width: 768px){
  .customer-list{ padding: 0; }
  .customer-row{
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .customer-actions{ justify-content: flex-start; }
}

      /* Inline validation */
.field-error{
  border-color: rgba(180,35,24,.65) !important;
  box-shadow: 0 0 0 4px rgba(180,35,24,.12) !important;
  background: rgba(180,35,24,.03) !important;
}

.field-ok{
  border-color: rgba(184,154,91,.55) !important;
  box-shadow: 0 0 0 4px rgba(184,154,91,.12) !important;
}

    </style>
  </head>

  <body>
    <div class="container">
      <h1>EXACT Agents Portal</h1>

      <!-- Logged-in header -->
      <div id="topBar" class="topbar" style="display:none;">
        <div class="row">
          <div>
            <div id="topBarTitle" style="font-weight:600;">Logged in</div>
            <div class="subtle" id="topBarSub"></div>
          </div>
          <div>
            <button id="logoutBtn">Logout</button>
          </div>
        </div>
      </div>

      <!-- Login -->
      <div id="loginBox" class="card" style="max-width:480px;">
        <h2 style="margin-top:0; color:var(--text);">Login</h2>

        <div style="margin-bottom:10px;">
          <input id="email" placeholder="Email" />
        </div>

        <div style="margin-bottom:10px;">
          <input id="password" type="password" placeholder="Password" />
        </div>

        <button id="loginBtn" class="btn-primary">Login</button>
        <p id="authMsg"></p>
      </div>

      <!-- Main app -->
      <div id="appBox" style="display:none;">
        <div class="appLayout">
          <!-- Role menu -->
          <div class="card menu" style="margin:0;">
            <h2 style="margin-top:0;">Menu</h2>
            <div id="menuItems"></div>
          </div>

          <!-- Content -->
          <div>
            <!-- ADMIN: Agent Management -->
            <div id="viewAgentMgmt" class="card" style="display:none;">
              <h2>Agent Management</h2>
              <p class="subtle" style="margin:0 0 10px 0;">
                (For now: view only. We’ll add create/edit/deactivate next.)
              </p>
              <p id="agentMsg"></p>
              <ul id="agentList"></ul>
            </div>

            <!-- CUSTOMER MANAGEMENT (admin + agent) -->
            <div id="viewCustomerMgmt" class="card" style="display:none;">
              <!-- Admin-only agent picker for inserts -->
              <div id="adminAgentPicker" style="display:none; margin-bottom:14px;">
                <label for="agentSelect" style="display:block; margin-bottom:6px; font-weight:600;">
                  Insert as clinic
                </label>
                <select id="agentSelect"></select>
              </div>

              <h2>Customer Management</h2>

              <div style="margin-bottom:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <button id="openAddCustomerBtn" class="btn-gold">Add customer</button>
                <button id="cancelAddCustomerBtn" style="display:none;">Cancel</button>
                <p id="custMsg" style="margin:0;"></p>
              </div>

              <div id="addCustomerPanel" style="display:none; margin-bottom:10px;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                  <input id="firstName" placeholder="First name" />
                  <input id="lastName" placeholder="Last name" />
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                  <input id="custEmail" placeholder="Email (optional)" />
                  <input id="custPhone" placeholder="Phone (optional)" />
                </div>

                <button id="addCustomerBtn" class="btn-primary">Save customer</button>
              </div>

              <div id="customerList" class="customer-list"></div>

            </div>

            <!-- ADMIN: Lab Management (placeholder) -->
            <div id="viewLabMgmt" class="card" style="display:none;">
              <h2>Lab Management</h2>
              <p class="subtle" style="margin:0 0 10px 0;">
                Placeholder for lab workflow (submissions, statuses, batches, etc.)
              </p>
              <p id="labMsg">Coming next.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Confirm dialog (used by confirmExact) -->
      <dialog id="confirmDialog">
        <h3 class="dialog-title">EXACT Agents Portal</h3>
        <p id="confirmDialogText" style="margin:0; color: var(--muted);"></p>
        <div class="dialog-actions">
          <button id="confirmCancelBtn" type="button">Cancel</button>
          <button id="confirmOkBtn" type="button" class="btn-danger">Delete</button>
        </div>
      </dialog>

      <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
      <script src="./app.js?v=27"></script>
    </div>
  </body>
</html>
